`Number of Completed Surveys` = as.numeric(`Number of Completed Surveys`),
`Survey Response Rate Percent`= as.numeric(`Survey Response Rate Percent`),
`Start Date` = as.Date(`Start Date`,  format = "%m/%d/%Y"),
`End Date` = as.Date(`End Date`, format = "%m/%d/%Y")) %>%
rename(Fac_ID = `Facility ID`,
Fac_name = `Facility Name`,
ZIP = `ZIP Code`,
County = `County Name`,
Meaure_ID= `HCAHPS Measure ID`,
Question = `HCAHPS Question`,
Answer = `HCAHPS Answer Description`,
Patient_Stars = `Patient Survey Star Rating`,
Answer_perc = `HCAHPS Answer Percent`,
Lin_mean = `HCAHPS Linear Mean Value`,
Num_completed_survs= `Number of Completed Surveys`,
Response_rate = `Survey Response Rate Percent`,
Start = `Start Date`,
End = `End Date`)
}
ddd <- load_n_clean("/home/christian/Competitions/HCAHPS/Data/HCAHPS-Hospital.csv")
ddd
widen_questions <- function(dataframe) {
dataframe %>%
# filter just the values that are star ratings
filter(grepl("star rating", Question)) %>%
# Remove the "-star rating from all questions to make it simpler
mutate(Question = str_replace(Question, " - star rating", ""),
# Convert number of stars to numeric value
Patient_Stars = as.numeric(Patient_Stars)) %>%
pivot_wider(id_cols = c(Fac_ID, ZIP, County, State), names_from = Question, values_from= Patient_Stars)
}
widen_questions(ddd)
data_dir <- "/home/christian/Competitions/HCAHPS/Data/"
data_dir <- "/home/christian/Competitions/HCAHPS/Data/"
years <- c("2015", "2020", "2021", "2022")
data_dir <- paste0(data_dir(years), "/")
data_dir <- paste0(data_dir, years, "/")
data_dir
dir("/home/christian/Competitions/HCAHPS/Data/2015/")
grepl("HCAHPS*Hospital.csv", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
grepl("*HCAHPS*Hospital.csv", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
grepl("*HCAHPS*Hospital*", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
dir("/home/christian/Competitions/HCAHPS/Data/2015/")
grepl("HCAHPS", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
data_dir
dir(data_dir)
dir(data_dir, full.names = T)
data_dir <- paste0(data_dir, years)
data_dir <- "/home/christian/Competitions/HCAHPS/Data/"
years <- c("2015", "2020", "2021", "2022")
data_dir <- paste0(data_dir, years)
dir(data_dir)
# Get data that has HCAPHS
H <- grepl("HCAPHS", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
# Get data that has Hospital
H <- grepl("Hospital", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
# Get data that has HCAPHS
H1 <- grepl("HCAPHS", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
# Combine
H1+H2
# Get data that has HCAPHS
H1 <- grepl("HCAPHS", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
# Get data that has Hospital
H2 <- grepl("Hospital", dir("/home/christian/Competitions/HCAHPS/Data/2015/"))
# Combine
H1+H2
# Combine
H <- H1+H2
data_dir <- "/home/christian/Competitions/HCAHPS/Data/"
years <- c("2015", "2020", "2021", "2022")
paths <- dir(paste0(data_dir, years), full.names = T)
paths
# Get data that has HCAPHS
H1 <- grepl("HCAPHS", paths)
# Get data that has Hospital
H2 <- grepl("Hospital", paths)
H1
H2
paths
# Get data that has HCAPHS
H1 <- grepl("/HCAHPS", paths)
# Get data that has Hospital
H2 <- grepl("Hospital", paths)
# Combine
H <- H1+H2
H
# Get data that has HCAPHS
H1 <- grepl("/HCAHPS", paths)
H1
data_dir <- "Data/"
years <- c("2015", "2020", "2021", "2022")
paths <- dir(paste0(data_dir, years), full.names = T)
paths <- dir(paste0(data_dir, years), full.names = F)
paths
data_dir <- "Data/"
years <- c("2015", "2020", "2021", "2022")
getwd()
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- c("2015", "2020", "2021", "2022")
paths <- dir(paste0(data_dir, years), full.names = F)
paths
years
paste0(data_dir, years)
dir(paste0(data_dir, years))
getwd()
knitr::opts_knit$set(root.dir = "/home/christian/Competitions/HCAHPS/")
getwd()
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- c("2015", "2020", "2021", "2022")
paths <- dir(paste0(data_dir, years), full.names = F)
paths
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, years), full.names = F)
paths <- paste0(data_dir, years, paths)
paths
library(tidyverse)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, "/", years), full.names = F)
paths <- paste0(data_dir, years, paths)
# Get data that has HCAPHS
H1 <- grepl("/HCAHPS", paths)
# Get data that has Hospital
H2 <- grepl("Hospital", paths)
# Combine
H <- H1+H2
H
H1
H2
paths
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, "/", years), full.names = F)
paths <- paste0(data_dir, years, paths)
paths
paths <- dir(paste0(data_dir, "//", years), full.names = F)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, "/", years), full.names = F)
paths <- paste0(data_dir, "/", years, paths)
paths
library(tidyverse)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, years), full.names = F)
paths <- paste0(data_dir, "/", years, paths)
paths
paths <- paste0(data_dir,  years, paths)
library(tidyverse)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, years), full.names = F)
paths <- paste0(data_dir,  years, paths)
paths
paths <- paste0(data_dir,  years, "/" paths)
paths <- paste0(data_dir,  years, "/", paths)
paths
# Get data that has HCAPHS
H1 <- grepl("HCAHPS", paths)
# Get data that has Hospital
H2 <- grepl("Hospital", paths)
# Combine
H <- H1+H2
H
H1
H2
# Combine
H <- H1|H2
H
# Combine
H <- H1 & H2
H
sum(H)
# Convert numeric values to numeric, and rename for convenience
# Function to load and clean data from HCAHPS
load_n_clean <- function(filepath) {
# Load data at the specified file path
df <- read_csv(filepath)
df %>%
mutate(`HCAHPS Answer Percent` = as.numeric(`HCAHPS Answer Percent`),
`HCAHPS Linear Mean Value` = as.numeric(`HCAHPS Linear Mean Value` ),
`Number of Completed Surveys` = as.numeric(`Number of Completed Surveys`),
`Survey Response Rate Percent`= as.numeric(`Survey Response Rate Percent`),
`Start Date` = as.Date(`Start Date`,  format = "%m/%d/%Y"),
`End Date` = as.Date(`End Date`, format = "%m/%d/%Y")) %>%
# Rename for convenience
rename(Fac_ID = `Facility ID`,
Fac_name = `Facility Name`,
ZIP = `ZIP Code`,
County = `County Name`,
Meaure_ID= `HCAHPS Measure ID`,
Question = `HCAHPS Question`,
Answer = `HCAHPS Answer Description`,
Patient_Stars = `Patient Survey Star Rating`,
Answer_perc = `HCAHPS Answer Percent`,
Lin_mean = `HCAHPS Linear Mean Value`,
Num_completed_survs= `Number of Completed Surveys`,
Response_rate = `Survey Response Rate Percent`,
Start = `Start Date`,
End = `End Date`)
}
widen_questions <- function(dataframe) {
dataframe %>%
# filter just the values that are star ratings
filter(grepl("star rating", Question)) %>%
# Remove the "-star rating from all questions to make it simpler
mutate(Question = str_replace(Question, " - star rating", ""),
# Convert number of stars to numeric value
Patient_Stars = as.numeric(Patient_Stars)) %>%
pivot_wider(id_cols = c(Fac_ID, ZIP, County, State), names_from = Question, values_from= Patient_Stars)
}
# Get data that has HCAPHS
H1 <- grepl("HCAHPS", paths)
# Get data that has Hospital
H2 <- grepl("Hospital", paths)
# Combine
H <- H1 & H2
df <- read_csv("/home/christian/Competitions/HCAHPS/Data/HCAHPS-Hospital.csv")
H
files <- paths[H]
files
# drop missingness over 50%
nonmissing_columns <- c("Facility ID", "Facility Name", "Address", "City", "State", "ZIP Code", "County Name", "Phone Number", "HCAHPS Measure ID", "HCAHPS Question", "HCAHPS Answer Description", "Patient Survey Star Rating", "HCAHPS Answer Percent", "HCAHPS Linear Mean Value", "Number of Completed Surveys", "Survey Response Rate Percent", "Start Date", "End Date")
load_n_clean(files[[1]]) %>%
widen_questions()
library(tidyverse)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, years), full.names = F)
paths <- paste0(data_dir,  years, "/", paths)
paths
load_n_clean(files[[1]]) %>%
widen_questions()
library(tidyverse)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, years), full.names = F)
paths <- paste0(data_dir,  years, "/", paths)
paths
getwd()
files <- paths[H]
files
# Convert numeric values to numeric, and rename for convenience
# Function to load and clean data from HCAHPS
load_n_clean <- function(filepath) {
# Load data at the specified file path
df <- read_csv(paste0(getwd(), filepath))
df %>%
mutate(`HCAHPS Answer Percent` = as.numeric(`HCAHPS Answer Percent`),
`HCAHPS Linear Mean Value` = as.numeric(`HCAHPS Linear Mean Value` ),
`Number of Completed Surveys` = as.numeric(`Number of Completed Surveys`),
`Survey Response Rate Percent`= as.numeric(`Survey Response Rate Percent`),
`Start Date` = as.Date(`Start Date`,  format = "%m/%d/%Y"),
`End Date` = as.Date(`End Date`, format = "%m/%d/%Y")) %>%
# Rename for convenience
rename(Fac_ID = `Facility ID`,
Fac_name = `Facility Name`,
ZIP = `ZIP Code`,
County = `County Name`,
Meaure_ID= `HCAHPS Measure ID`,
Question = `HCAHPS Question`,
Answer = `HCAHPS Answer Description`,
Patient_Stars = `Patient Survey Star Rating`,
Answer_perc = `HCAHPS Answer Percent`,
Lin_mean = `HCAHPS Linear Mean Value`,
Num_completed_survs= `Number of Completed Surveys`,
Response_rate = `Survey Response Rate Percent`,
Start = `Start Date`,
End = `End Date`)
}
load_n_clean(files[[1]]) %>%
widen_questions()
paths
getwd()
load_n_clean(files[[1]]) %>%
widen_questions()
load_n_clean(files[[1]]) %>%
widen_questions()
getwd()
library(tidyverse)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, years), full.names = F)
paths <- paste0(data_dir,  years, "/", paths)
# Convert numeric values to numeric, and rename for convenience
# Function to load and clean data from HCAHPS
load_n_clean <- function(filepath) {
# Load data at the specified file path
df <- read_csv(paste0(getwd(), filepath))
df %>%
mutate(`HCAHPS Answer Percent` = as.numeric(`HCAHPS Answer Percent`),
`HCAHPS Linear Mean Value` = as.numeric(`HCAHPS Linear Mean Value` ),
`Number of Completed Surveys` = as.numeric(`Number of Completed Surveys`),
`Survey Response Rate Percent`= as.numeric(`Survey Response Rate Percent`),
`Start Date` = as.Date(`Start Date`,  format = "%m/%d/%Y"),
`End Date` = as.Date(`End Date`, format = "%m/%d/%Y")) %>%
# Rename for convenience
rename(Fac_ID = `Facility ID`,
Fac_name = `Facility Name`,
ZIP = `ZIP Code`,
County = `County Name`,
Meaure_ID= `HCAHPS Measure ID`,
Question = `HCAHPS Question`,
Answer = `HCAHPS Answer Description`,
Patient_Stars = `Patient Survey Star Rating`,
Answer_perc = `HCAHPS Answer Percent`,
Lin_mean = `HCAHPS Linear Mean Value`,
Num_completed_survs= `Number of Completed Surveys`,
Response_rate = `Survey Response Rate Percent`,
Start = `Start Date`,
End = `End Date`)
}
widen_questions <- function(dataframe) {
dataframe %>%
# filter just the values that are star ratings
filter(grepl("star rating", Question)) %>%
# Remove the "-star rating from all questions to make it simpler
mutate(Question = str_replace(Question, " - star rating", ""),
# Convert number of stars to numeric value
Patient_Stars = as.numeric(Patient_Stars)) %>%
pivot_wider(id_cols = c(Fac_ID, ZIP, County, State), names_from = Question, values_from= Patient_Stars)
}
setwd("/home/christian/Competitions/HCAHPS/")
setwd("/home/christian/Competitions/HCAHPS/")
load_n_clean(files[[1]]) %>%
widen_questions()
# Convert numeric values to numeric, and rename for convenience
# Function to load and clean data from HCAHPS
load_n_clean <- function(filepath) {
# Load data at the specified file path
df <- read_csv(paste0(getwd(), "/", filepath))
df %>%
mutate(`HCAHPS Answer Percent` = as.numeric(`HCAHPS Answer Percent`),
`HCAHPS Linear Mean Value` = as.numeric(`HCAHPS Linear Mean Value` ),
`Number of Completed Surveys` = as.numeric(`Number of Completed Surveys`),
`Survey Response Rate Percent`= as.numeric(`Survey Response Rate Percent`),
`Start Date` = as.Date(`Start Date`,  format = "%m/%d/%Y"),
`End Date` = as.Date(`End Date`, format = "%m/%d/%Y")) %>%
# Rename for convenience
rename(Fac_ID = `Facility ID`,
Fac_name = `Facility Name`,
ZIP = `ZIP Code`,
County = `County Name`,
Meaure_ID= `HCAHPS Measure ID`,
Question = `HCAHPS Question`,
Answer = `HCAHPS Answer Description`,
Patient_Stars = `Patient Survey Star Rating`,
Answer_perc = `HCAHPS Answer Percent`,
Lin_mean = `HCAHPS Linear Mean Value`,
Num_completed_survs= `Number of Completed Surveys`,
Response_rate = `Survey Response Rate Percent`,
Start = `Start Date`,
End = `End Date`)
}
widen_questions <- function(dataframe) {
dataframe %>%
# filter just the values that are star ratings
filter(grepl("star rating", Question)) %>%
# Remove the "-star rating from all questions to make it simpler
mutate(Question = str_replace(Question, " - star rating", ""),
# Convert number of stars to numeric value
Patient_Stars = as.numeric(Patient_Stars)) %>%
pivot_wider(id_cols = c(Fac_ID, ZIP, County, State), names_from = Question, values_from= Patient_Stars)
}
load_n_clean(files[[1]]) %>%
widen_questions()
load_n_clean(files[[1]])
setwd("/home/christian/Competitions/HCAHPS/")
load_n_clean(files[[1]])
files
library(tidyverse)
setwd("/home/christian/Competitions/HCAHPS/")
data_dir <- "Data/"
years <- dir(data_dir)
paths <- dir(paste0(data_dir, years), full.names = F)
paths <- paste0(data_dir,  years, "/", paths)
# Convert numeric values to numeric, and rename for convenience
# Function to load and clean data from HCAHPS
load_n_clean <- function(filepath) {
# Load data at the specified file path
df <- read_csv(paste0(getwd(), "/", filepath))
df %>%
mutate(`HCAHPS Answer Percent` = as.numeric(`HCAHPS Answer Percent`),
`HCAHPS Linear Mean Value` = as.numeric(`HCAHPS Linear Mean Value` ),
`Number of Completed Surveys` = as.numeric(`Number of Completed Surveys`),
`Survey Response Rate Percent`= as.numeric(`Survey Response Rate Percent`),
`Start Date` = as.Date(`Start Date`,  format = "%m/%d/%Y"),
`End Date` = as.Date(`End Date`, format = "%m/%d/%Y")) %>%
# Rename for convenience
rename(Fac_ID = `Facility ID`,
Fac_name = `Facility Name`,
ZIP = `ZIP Code`,
County = `County Name`,
Meaure_ID= `HCAHPS Measure ID`,
Question = `HCAHPS Question`,
Answer = `HCAHPS Answer Description`,
Patient_Stars = `Patient Survey Star Rating`,
Answer_perc = `HCAHPS Answer Percent`,
Lin_mean = `HCAHPS Linear Mean Value`,
Num_completed_survs= `Number of Completed Surveys`,
Response_rate = `Survey Response Rate Percent`,
Start = `Start Date`,
End = `End Date`)
}
widen_questions <- function(dataframe) {
dataframe %>%
# filter just the values that are star ratings
filter(grepl("star rating", Question)) %>%
# Remove the "-star rating from all questions to make it simpler
mutate(Question = str_replace(Question, " - star rating", ""),
# Convert number of stars to numeric value
Patient_Stars = as.numeric(Patient_Stars)) %>%
pivot_wider(id_cols = c(Fac_ID, ZIP, County, State), names_from = Question, values_from= Patient_Stars)
}
# Get data that has HCAPHS
H1 <- grepl("HCAHPS", paths)
# Get data that has Hospital
H2 <- grepl("Hospital", paths)
# Combine
H <- H1 & H2
files <- paths[H]
# drop missingness over 50%
nonmissing_columns <- c("Facility ID", "Facility Name", "Address", "City", "State", "ZIP Code", "County Name", "Phone Number", "HCAHPS Measure ID", "HCAHPS Question", "HCAHPS Answer Description", "Patient Survey Star Rating", "HCAHPS Answer Percent", "HCAHPS Linear Mean Value", "Number of Completed Surveys", "Survey Response Rate Percent", "Start Date", "End Date")
H
files
setwd("/home/christian/Competitions/HCAHPS/")
load_n_clean(files[[1]])
load_n_clean(files[[4]])
\dnorm(−0.68599, mean=0, sd = 1)
dnorm(−0.68599, mean=0, sd = 1)
dnorm(-0.68599, mean=0, sd = 1)
pnorm(-0.68599, 0, 1)
1- pnorm(-0.68599, 0, 1)
# select complications and death
paths <- paths[grepl("Payment_and_Value_of_Care-Hospital\|/home/christian/Competitions/HCAHPS_2022_10/Data/2021/Timely_and_Effective_Care-Hospital.csv", paths)]
# Data cleaning
library(dplyr)
library(tidyr)
# Paste into a tibble using datapasta and "paste as tribble"
x <-
tibble::tribble(
~i.Yi.ti.ri,
"1 5 94.320 0.053",
"2 1 15.720 0.064",
"3 5 62.880 0.080",
"4 14 125.760 0.111",
"5 3 5.240 0.573",
"6 19 31.440 0.604",
"7 1 1.048 0.954",
"8 1 1.048 0.954",
"9 4 2.096 1.910",
"10 22 10.480 2.099"
)
x
# Clean columns
pump_data <- x %>%
separate(1, into = c("i", "Y", "t", "r"), convert = TRUE, sep = " ")
x
pump_data
# Summary statistics
rbar <- mean(pump_data$r)
s2r <- var(pump_data$r)
st <- sum(1/pump_data$t)
n <- nrow(pump_data)
st
# MoM estimators
a <- n * rbar^2 / (s2r - rbar/n * st)
b <- n * rbar / (s2r - rbar/n * st)
a
b
# MoM estimators
b <- n * rbar / (s2r - rbar/n * st)
a <- b * rbar^2
a
b
# MoM estimators
b <- n * rbar / (s2r - rbar/n * st)
a <- b * rbar^2
a
b
a <- rbar * b
# MoM estimators
b <- n * rbar / (s2r - rbar/n * st)
a <- rbar * b
a
b
# MoM estimators
b <- n * rbar / (s2r - rbar/n * st)
a <- rbar * b
a
b
a/b
qnorm(0.95, 0, 1)
library(tidyverse)
setwd("/home/christian/Research/Stat_gen/tools/Basu_herit/")
df <- read.csv("Example/covar.csv", header = F)
df$V5 <- rnorm(dim(df)[1], 0, 4)
df$V6 <- rnorm(dim(df)[1], 0, 4)
df$V7 <- rnorm(dim(df)[1], 0, 4)
write.csv(df, "Example/covar.csv", quote = F, row.names= F, col.names = F)
